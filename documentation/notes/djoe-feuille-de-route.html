*Messagerie instantanée: feuille de route

Dépôt Github: https://github.com/remipassmoilesel/djoe

Feuille de route mise à jour en temps réel à l'adresse: http://im.silverpeas.net:9001/p/feuille-de-route

*Avancement
*En cours:
* Tester les invitations de salon, qui répondent mal sur localhost
* Tester les notifications d'écriture à plusieurs
* Tester les conversations multiples, problème de bookmark et de déconnexion

*17/06/2016
* Premières invitation à une conversation
* Gestion des notifications d'invitation à une conversation
* Boite de dialogue d'acceptation d'invitation à une conversation
* Premières notifications d'écriture, support multi utilisateur
* Configuration du proxy TLS Apache 2 / Etherpad
* Première intégration d'Etherpad dans une conversation de groupe: ouvrir une conversation, menu haut droit, "Ouvrir un pad"

*16/06/2016
* Gestion du problème des bookmark (temporaire mais fonctionnelle, issue en cours)
* Première installation de SP 6

*15/06/2016
* Suppression de salons par REST (aide au développement)
* Ajout d'un utilitaire d'inspection du traffic XMPP
* Première configuration automatique des salons
* Ajout d'un dialogue de sélection de conversation pour invitation
* Premières invitations pour rejoindre un salon

*14/06/2016
* Ecriture de cas d'utilisation textuels
* Premier examen de de la XEP 0085 permettant la mise en place d'un indicateur de frappe
* Simplification du menu
* Ajout d'un widget de sélection d'amis
* Première ouverture de salons à partir d'une sélection
* Tri des utilisateurs dans le widget d'affichage des amis

*13/06/2016
* Amélioration de la recherche d'utilisateurs
* Découverte d'un problème: si le localStorage est vidé, le GUI ne s'initialise pas: obligatoirement initialiser l'adresse du seveur MUC pour éviter ces problèmes
* Amélioration de la journalisation de JSXC / Strophe
* Changement de logo, améliorations de style
* Amélioration des consoles de stockage et events Jquery pour debuggage
* Point sur l'avancement de début de semaine. CR simplifié:
* Mettre des use case d'utilisation de salons par écrit
* Explorer la possibilité de faire abstraction de la notion de salon, pour simplifier l'expérience utilisateur
* Avancer dès que possible sur l'indicateur de frappe
* Etudier la possibilité d'utiliser les avatars Silverpeas
* Etudier la possibilité d'utiliser des pads liés à une conversation (nom du pad <> room jid)
*
*10/06/2016
* Création d'un widget "liste d'utilisateurs" empaquetée dans un utilitaire
* Modification du système de feedback, ajout de toasts
* Suppression de contacts à partir du nouveau menu
* Création d'un element d'affichage des salons
* Possibilité de rejoindre un salon à partir du nouveau menu
* Création de salons à partir du nouveau menu
*
*09/06/2016
* Déplacement des notifications d'ajout
* Possibilité d'afficher une stack trace en cas d'erreur
* Module de recherche d'utilisateur operationnel
* Méthode getter pour la liste des JID enregistrés en local
* Première demande d'ajout à partir d'une liste !!!
* Mise en cache des résultats de recherche d'utilisateurs (uniquement pour les demandes de tous les utilisateurs)
* Création d'un utilitaire de création de zone de feedback
*
*08/06/2016
* Mise en place du nouveau menu
* Association des actions aux elements du menu
* Etude de la découverte de services XMPP
* Ajout d'une console de découverte de services XMPP (/xmpp-disco)
* Etude du fonctionnement des salons
* Ajout du logo CLPS
* Mise à jour de jsdoc
* Installation du thème graphique Jquery Silverpeas (merci Aurore !)
* Première requête de recheche d'utilisateurs

*07/06/2016
* Première mise en place du nouveau menu
* Mise à jour de Jquery et Jquery UI
* Correction du Gruntfile

*06/06/2016
* Première ébauche d'un nouveau menu: https://im.silverpeas.net/playground/menu-accordion.html
* Mise en ordre des notes (djoe/notes)
* Début de test de la messagerie et des appels WebRTC dans des conditions de pare feu restrictif. A l'aide d'un script établissant des régles IPTABLES, la messagerie à été testée avec ces ports ouverts seulement:
* 80 tcp / udp (HTTP)
* 443 tcp / udp (HTTPS)
* 7443 tcp / udp (BOSH S)
* (plus le service DNS)
Remarque: Le passage du serveur XMPP sur 443 permettra à terme de se passer du dernier port, ce qui permettra normalement l'utilisation de la messagerie dans des
conditions très strictes.
* Mise en ligne de la feuille de route sur l'Intranoo

*03/06/2016
* Installation de Monitorix pour surveiller l'activité du serveur: http://im.silverpeas.net:8080/monitorix-cgi/monitorix.cgi?mode=localhost&graph=all&when=1day&color=black
* Problèmes de certificats TLS Android / IOS résolu
* Installation et test du serveur Coturn (rfc-5766-turn-server)
* Correction du firewall pour autoriser le trafic UDP TURN
* Vidéo disponible sur Android avec la dernière version de Chrome !

*02/06/2016
* Correction des erreurs 404 concernant le chargement des images de JSXC
* Notes complétées
* Création d'un script de synchronisation SSH / RSYNC pour envoyer les fichiers modifiés vers le serveur
* Création d'un script de récupération des fichiers de configuration du serveur distant
* Reconfiguration d'Apache et du serveur reTurn
* Modification du firewall du serveur (règles iptables) pour autorisation du trafic UDP sur les ports WebRTC
* Configuration de la chaine de certificats pour Firefox et Chrome Android

*01/06/2016
* Ajout d'une liste de sélection de compte et d'un bouton de déconnexion
* Création d'une branche pour le nouveau menu d'interface et début de conception
* Activation possible du log JSXC
* Réinstallation complète du système avec les nouveaux certificat + base de données MariaDB pour Openfire
* Création d'un premier fichier de notes sur l'installation: voir notes/installation.txt
* Essais supplémentaires avec reTurn

*31/05/2016
* Prise en main de l'environnement de développement de JSXC et premiers builds: Node 4, Bower, Grunt, ...
* Création d'une console de suivi des évenements JQuery pour debuggage (onglet 'Informations utiles')
* Console localStorage et dataStorage (Pour apprentissage)
* Début d'étude de l'interface

*30/05/2016
* Essai du plugin Openfire DBAccess pour debuggage
* Premiers essais de l'API REST d'Openfire pour gestion des utilisateurs (voir http://..../openfire-rest/)
* Identification du problème de connexion Firefox: malgré l'utilisation du même certificat par Apache et Openfire, sur Firefox l'utilisateur doit ajouter explicitement une exception de sécurité pour Openfire (https://test-messagerie.ddns.net:7443)
* Demande d'interfaces réseau supplémentaire + domaines + certificats signés
* Premiers essais avec Prosody

*27/05/2016
* Plusieurs test audio/vidéo. La communication utilisée semble de bonne qualité mais le service TURN ne fonctionne pas
* Installation et essai du serveur TURN reTurn. Le protocole Jingle essai de se connecter mais une erreur survient (TLS ?)
* Configuration TLS des serveurs Apache  et Openfire pour permettre l'utilisation de WebRTC
* Installation du plugin "populate users" Openfire permettant de créer des contacts factices
* Installation du plugin "import export" pour importer des utilisateurs au format XML - marche pas :(

*26/05/2015
* Mise en place du serveur
* Installation de JSXC
* Installation de Kaiwa
* Désactivation de la fonctionnalité OTR de JSXC
* Ajout de plugins à Etherpad (titres, ...)
*
*25/05/2016
* Adaptation d'une console d'observation du trafic XMPP pour debuggage: http://test-messagerie.ddns.net/console/

*24/05/2016
* Création des images Docker de JSXC et Kaiwa, et de l'environnement de travail

*Améliorations indispensables
* Tutoriel de présentation à l'aide de intro.js: http://introjs.com
* Notes sur l'installation des certificats intermédiaires
* Mettre des credential TURN variables, pour éviter surveiller l'utilisation du serveur
* Mise à jour de l'utilisation de WebRTC: enlever le code déprécié
* Création de salons / canaux avec titres, descriptions, et mots clefs
* Invitation de participants
* Interface: mode plein écran et fenêtre distincte
* Notifications sonores et notifications de bureau
* Lien d'ajout d'un utilisateur au répertoire
* Mise en favoris de messages ou d'utilisateurs
* Recherche rapide polyvalente: utilisateurs,messages, …
* Feedback de présence
* Augmenter la mémoire vive allouée au serveur au max

Travail d'interface:
* Enlever le cadenas dévérouillé en bas de la fenêtre de chat
* Supprimer l'affichage du domaine des contact dans le roster

Reconfiguration des serveurs:
* Une interface réseau pour le bosh, le http, le https avec redirection Apache
* Un domaine http/https de distribution de page / code: "/"
* Un domaine BOSH / BOSH S
* Deux interfaces pour le BOSH / BOSH S


*Fonctionnalités d'intérêt secondaire
* Remplacer slimscroll par perfectscrollbar: plus efficace, moins contraignant
* Inclure le démarrage d'Apache dans le script Upstart ?
* Placer le service bosh sur le port 80 et 443. Utiliser une redirection d'hote virtuel Apache ?
* Edition de statuts personnalisés: disponible, indisponible, personnalisé...
* Formatage de texte HTML/WYSIWYG
* Liens vers les autres fonctionnalités de la plateforme : votes, enquêtes, agenda,
* Surveillance d'activité : statut indisponible après 15 minutes d'inactivité sur la page, …
* Réutilisation de conversation : afficher une conversation sur une page dédiée permettant l'impression ou éventuellement l'édition dans un traitement de texte. Possibilité d'envoi vers Etherpad ?
* Mise en forme et supports multimédia. Reconnaissance de ressources collées dans l'espace de discussion : liens(ressources web, applications, …), numéros de téléphone,mots-clefs #, utilisateurs @, vidéos embarquées, dates, ...
* Modifier le titre de la page à l'arrivée d'un message, tout en conservant le titre original (alterner à interval de temps régulier ?)
* Rendre l'utilisation des avatars possibles ? (déjà implémenté dans JSXC et dans la plupart des serveurs XMPP)
*
*Fonctionnalités à l'étude
Partage d'écran
* Partager un flux vidéo d'écran
* Partager un flux voix
* Eventuellement partager un flux de dessin raster transparent superposé à la fenêtre (fonctions simple de tracé coloré / effaçage)
Intégration de l'édition de texte collaborative avec Etherpad
* Fenêtre d'édition intégrée dans un popup ou ouverture possible dans un nouvel onglet
* Accès à une liste d'éditeurs ouverts
Intégration du dessin collaboratif: https://github.com/JohnMcLear/draw
* Fenêtre d'édition intégrée dans un popup ou ouverture possible dans un nouvel onglet
* Accès à une liste d'éditeurs ouverts
Image docker pour server-side avec un utilisateur par serveur
Fonctionnalités de mise en exergue de message : l'apparence du message est modifié pour mettre en valeur un contenu et le rendre plus lisible : vote, décision commune, ...
Formatage de texte optionnel au format Markdown. Format facile d'accès pour l'utilisateur et facile à intégrer.
Système de tag permettant d'être notifié de l'arrivée d'un message d'une catégorie particulière ou destiné à un utilisateur permettant d'être abonné à certains sujet.
Essayer plusieurs conversations simultanées pour observer la montée en charge sur monitorix
Créer une méthode d'observation des protocoles utilisés par Strophe.jingle: XMPP Inband ? Stun ? Turn ? Paire à paire ?
Essayer le serveur TURN du projet Jitsi
Essayer un Multi Point Control Unit

*Notes
*
Possibilité de transformation one to one > multi: voir xep 0045 http://xmpp.org/extensions/xep-0045.html#continue
Stockage arbitraire de données (pub sub virtuel): http://xmpp.org/extensions/xep-0223.html
Stockage de marque page: https://xmpp.org/extensions/xep-0048.html

Configuration de salon: voir self.showRoomConfiguration(room);
Inviter des utilsateurs sur un salon: Voir jsxc.xmpp.conn.muc.invite()

Notification d'écriture: voir XEP 0085
* https://github.com/strophe/strophejs-plugins/blob/master/chatstates/strophe.chatstates.js
* http://xmpp.org/extensions/xep-0085.html

/!\ /!\ /!\ /!\
Tous les utilisateurs sont chargés par les listes d'utilisateurs. Faire un test avec 1000, 2000 utilisateurs ?
Les résultats sont mis en cache mais le temps de l'arrivée de la première réponse plusieurs requête sont effectuées.

* Outil de diagnostic de communication RTC:
* Créer un utilitaire de création de zone de feedback dans jsxc.gui
* Outil de diagnostic de communication RTC:
* Log du type de communication et des outils utilisés (XMPP inband, WebRTC, TURN, STUN, ...)
* Sortie console
* Sortie texte envoyée en asynchrone à un serveur à chaque connexion / problème de connexion

Transfert de fichier: étudier le proxy SOCKS5 http://xmpp.org/extensions/xep-0065.html










