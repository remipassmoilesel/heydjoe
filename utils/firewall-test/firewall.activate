#!/bin/sh

# Block all
iptables  -P INPUT DROP
iptables  -P FORWARD DROP
iptables  -P OUTPUT DROP
echo "- On bloque tout : [OK]"

# dont't remove established connexions
iptables  -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables  -A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

iptables  -A INPUT -i lo -j ACCEPT
iptables  -A OUTPUT -o lo -j ACCEPT
echo "- Loopback : [OK]"

# DNS In/Out
iptables  -A OUTPUT -p tcp --dport 53 -j ACCEPT
iptables  -A OUTPUT -p udp --dport 53 -j ACCEPT
iptables  -A INPUT -p tcp --dport 53 -j ACCEPT
iptables  -A INPUT -p udp --dport 53 -j ACCEPT
echo "- DNS : [OK]"

# HTTP + HTTPS Out
iptables  -A OUTPUT -p tcp --dport 80 -j ACCEPT
iptables  -A OUTPUT -p tcp --dport 443 -j ACCEPT

# HTTP + HTTPS In
iptables  -A INPUT -p tcp --dport 80 -j ACCEPT
iptables  -A INPUT -p tcp --dport 443 -j ACCEPT
echo "- Autoriser HTTP(s) : [OK]"

# STUN / TURN out
iptables  -A OUTPUT -p udp --dport 80 -j ACCEPT
iptables  -A OUTPUT -p udp --dport 443 -j ACCEPT

# STUN / TURN in
iptables  -A INPUT -p udp --dport 80 -j ACCEPT
iptables  -A INPUT -p udp --dport 443 -j ACCEPT

echo "- STUN / TURN : [OK]"

# BOSH
iptables  -A INPUT -p tcp --dport 7070 -j ACCEPT
iptables  -A OUTPUT -p tcp --dport 7070 -j ACCEPT

# BOSH S
iptables  -A INPUT -p tcp --dport 7443 -j ACCEPT
iptables  -A OUTPUT -p tcp --dport 7443 -j ACCEPT

echo "- BOSH / BOSH S: [OK]"

iptables -v -L

