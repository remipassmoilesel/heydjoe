<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: jsxc.lib.gui.widgets.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: jsxc.lib.gui.widgets.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Show a feedback message. Type can be 'info' or 'warn'
 *
 * @param selector
 * @returns {JQuery|jQuery|HTMLElement}
 */
jsxc.gui.feedback = function (message, type, timeout) {

    var defaultType = "info";

    var bgColors = {
        info: '#1a1a1a',
        warn: '#520400',
    };
    var icons = {
        info: 'info',
        warn: 'warning',
    };

    // show the toast
    $.toast({
        text: message, // Text that is to be shown in the toast
        icon: icons[type || defaultType], // Type of toast icon
        showHideTransition: 'slide', // fade, slide or plain
        allowToastClose: true, // Boolean value true or false
        hideAfter: timeout || 3000, // false to make it sticky or number representing the miliseconds as time after which toast needs to be hidden
        stack: 3, // false if there should be only one toast at a time or a number representing the maximum number of toasts to be shown at a time
        position: 'top-center', // bottom-left or bottom-right or bottom-center or top-left or top-right or top-center or mid-center or an object representing the left, right, top, bottom values
        textAlign: 'left',  // Text alignment i.e. left, right or center
        loader: false,  // Whether to show loader or not. True by default
        bgColor: bgColors[type || defaultType], // background color of toast
    });

};

/**
 * Create a filterable list. Need jquery.highlight.js.
 *
 * @param options
 */
jsxc.gui._createFilterableList = function (selector, options) {

    this.defaultOptions = {

        highlightClass: "filterableList-result",
        searchPlaceholder: "Rechercher ..."

    };

    var settings = $.extend({}, this.defaultOptions, options);

    // root of list
    var root = $(selector);
    root.addClass("jsxc_filterableList");

    // // must have position arg to avoid error with perfectscrollbar
    // root.css({
    //     position: "relative",
    // });

    // append search text field
    var searchTxt = $("&lt;input type='text' class='filterTextField' placeholder='" + settings.searchPlaceholder + "'/>");
    searchTxt.css({
        height: "26px",
        width: "100%"
    });
    searchTxt.appendTo(root);

    // list in a container for perfect scrollabr
    var container = $("&lt;div class='list_container'>&lt;/div>");
    container.css({
        position: "relative",
        width: "100%",
        height: '85%'
    });

    // append list to container
    var list = $("&lt;ol>&lt;/ol>");
    list.appendTo(container);

    // // fake items
    // for (var i = 0; i &lt; 300; i++) {
    //     list.append("&lt;li class='ui-widget-content'>" + chance.name() + "&lt;/li>");
    // }

    list.selectable();

    root.append(container);
    container.perfectScrollbar();

    // settings for highlight search results
    var highlightSettings = {
        caseSensitive: false,
        className: settings.highlightClass
    };

    // undo highlight
    var resetHighlight = function () {
        list.unhighlight(highlightSettings);
    };

    // search terms when user type
    var searchInList = function (rawTerms) {

        var terms = rawTerms.trim();

        // reset list
        list.find(".filterableNoResult").remove();
        resetHighlight();

        if (terms === "") {
            root.find("li").css({"display": "block"});

            container.perfectScrollbar("update");

            container.scrollTop(0);

            return;
        }

        // search terms
        list.highlight(terms, highlightSettings);

        // hide others
        var result = 0;
        root.find("li").each(function () {
            if ($(this).has("span." + settings.highlightClass).length === 0) {
                $(this).css({'display': 'none'});
            }
            else {
                $(this).css({'display': 'block'});
                result++;
            }
        });

        if (result &lt; 1) {
            list.prepend("&lt;li class='filterableNoResult'>Aucun résultat&lt;/li>");
        }

        container.perfectScrollbar("update");

        // scroll to top
        container.scrollTop(0);


    };

    searchTxt.keyup(function () {
        searchInList(searchTxt.val());
    });

    return root;

};

/**
 * Create a room list
 *
 * @param selector
 */
jsxc.gui.createRoomList = function (selector) {

    var root = $(selector);

    root.addClass("jsxc_roomListContainer");

    root.append("&lt;ol class='jsxc_roomList'>&lt;/ol>");

    var list = $(selector + " .jsxc_roomList");

    // make selectable list
    list.selectable();

    // make list scrollable
    root.perfectScrollbar();

    // refresh room list
    var updateRoomList = function () {

        jsxc.xmpp.conn.muc.listRooms(jsxc.options.get('muc').server,

            // getting list
            function (stanza) {

                list.empty();

                var items = $(stanza).find('item');

                // no rooms
                if (items.length &lt; 1) {

                    // create list element
                    var li = $("&lt;li>&lt;/li>")
                        .text("Aucun salon disponible")
                        .attr({
                            'class': 'ui-widget-content',
                            'roomjid': "_NO_ROOM_AVAILABLE"
                        });

                    list.append(li);

                }

                // list all rooms
                else {

                    items.each(function () {

                        var rjid = $(this).attr('jid').toLowerCase();
                        var rnode = Strophe.getNodeFromJid(rjid);
                        var rname = $(this).attr('name') || rnode;

                        // create list element
                        var li = $("&lt;li>&lt;/li>")
                            .text(rname)
                            .attr({
                                'data-roomjid': rjid,
                                'data-rname': rname,
                                'class': 'ui-widget-content',
                                'title': rjid
                            });

                        list.append(li);
                    });
                }

            },

            // error while getting list
            function () {

                list.empty();

                jsxc.debug("Unable to retrieve rooms", arguments);

                // create list element
                var li = $("&lt;li>&lt;/li>")
                    .text("Liste des salons indisponible")
                    .attr({
                        'class': 'ui-widget-content'
                    });

                list.append(li);
            });

    };

    // update each time buddy list change
    $(document).on("status.muc.jsxc", updateRoomList);

    // first update
    updateRoomList();

    return {
        /**
         * Jquery object on root
         */
        "root": root,

        /**
         * Update list
         */
        "updateRoomList": updateRoomList
    };

};

/**
 * Create an user list. To retrieve selected elements select $("#listId .ui-selected");
 *
 *
 * &lt;p>Each item contains data:
 *
 * &lt;p>'data-userjid': elmt.jid, 'data-username': elmt.username,
 *
 *
 * @param selector
 */
jsxc.gui.createUserList = function (selector) {

    // var root = $(selector);

    console.log(selector);

    var root = jsxc.gui._createFilterableList(selector);
    root.addClass("jsxc_userListContainer");

    var list = root.find("ol");

    // update lists
    var updateUserList = function (freshList) {

        var search = jsxc.xmpp.search.getUserList;

        if (freshList === "freshList") {
            search = jsxc.xmpp.search.getFreshUserList;
        }

        // add contact to list
        search().then(function (users) {

                // remove exisiting elements
                list.empty();

                // add users
                $.each(users, function (index, elmt) {

                    // check if not user
                    if (elmt.username === jsxc.xmpp.getCurrentNode()) {
                        return true;
                    }

                    // create list element
                    var li = $("&lt;li>&lt;/li>")
                        .text(elmt.username)
                        .attr({
                            'data-userjid': elmt.jid,
                            'data-username': elmt.username,
                            'class': 'ui-widget-content',
                            'title': elmt.username + " n'est pas dans vos contacts"
                        });

                    // modify element if buddy
                    if (elmt._is_buddy) {
                        li.addClass("buddy_item")
                            .attr({
                                'title': elmt.username + " est dans vos contacts"
                            });
                    }

                    list.append(li);
                });
            },

            // error while updating
            function () {

                // remove exisiting elements
                list.empty();

                var li = $("&lt;li>&lt;/li>")
                    .text("Liste des contacts indisponible")
                    .attr({'class': 'ui-widget-content'});

                list.append(li);

            });
    };

    // update each time buddy list change
    $(document).on("add.roster.jsxc", updateUserList);
    $(document).on("cloaded.roster.jsxc", updateUserList);
    $(document).on("buddyListChanged.jsxc", updateUserList);

    // first update
    updateUserList();

    return {
        /**
         * Jquery object on root
         */
        "root": root,

        /**
         * Update list
         */
        "updateUserList": updateUserList
    };

};

/**
 * Create a buddy list. To retrieve selected elements select $("#listId .ui-selected");
 *
 *
 * &lt;p>Each item contains data:
 *
 * &lt;p>'data-userjid': elmt.jid, 'data-username': elmt.username,
 *
 *
 * @param selector
 */
jsxc.gui.createBuddyList = function (selector) {

    var root = $(selector);

    root.addClass("jsxc_widget-buddylistContainer");

    root.append("&lt;ol class='jsxc_widget-buddylist'>&lt;/ol>");

    var list = $(selector + " .jsxc_widget-buddylist");

    // make selectable list
    list.selectable();

    // make list scrollable
    root.perfectScrollbar();

    // update lists
    var updateBuddyList = function () {

        list.empty();

        var buddylist = jsxc.storage.getLocaleBuddyListBJID();

        var buddyNumber = 0;

        $.each(buddylist, function (index, jid) {

            //console.log(jsxc.storage.getUserItem('buddy', Strophe.getBareJidFromJid(jid)));

            var infos = jsxc.storage.getUserItem('buddy', Strophe.getBareJidFromJid(jid));

            // check friendship
            var realFriend = infos.sub === 'both' &amp;&amp; infos.type !== 'groupchat';

            if (realFriend !== true) {
                return true;
            }

            var userName = Strophe.getNodeFromJid(jid);

            // create list element
            var li = $("&lt;li>&lt;/li>")
                .text(userName)
                .attr({
                    'data-userjid': jid,
                    'data-username': userName,
                    'class': 'ui-widget-content'
                });

            list.append(li);

            buddyNumber++;

        });

        if (buddyNumber &lt; 1) {
            // create list element
            var li = $("&lt;li>&lt;/li>")
                .text("Aucun contact confirmé")
                .attr({
                    'data-userjid': null,
                    'data-username': null,
                    'class': 'ui-widget-content'
                });

            list.append(li);
        }

    };

    // update each time buddy list change
    $(document).on("add.roster.jsxc", updateBuddyList);
    $(document).on("cloaded.roster.jsxc", updateBuddyList);
    $(document).on("buddyListChanged.jsxc", updateBuddyList);

    // first update
    updateBuddyList();

    return {
        /**
         * Jquery object on root
         */
        "root": root,

        /**
         * Update list
         */
        "updateBuddyList": updateBuddyList
    };

};

/**
 * Create a conversation list. To retrieve selected elements select $("#listId .ui-selected");
 *
 *
 * &lt;p>Each item contains data:
 *
 * &lt;p>'data-conversjid'
 *
 *
 * @param selector
 */
jsxc.gui.createConversationList = function (selector) {

    var root = $(selector);

    root.addClass("jsxc_conversationListContainer");

    root.append("&lt;ol class='jsxc_conversationList'>&lt;/ol>");

    var list = $(selector + " .jsxc_conversationList");

    // make selectable list
    list.selectable();

    // make list scrollable
    root.perfectScrollbar();

    // update lists
    var updateConversationList = function () {

        list.empty();

        var conversList = jsxc.storage.getLocaleBuddyListBJID();

        var conversNumber = 0;

        $.each(conversList, function (index, jid) {

            var infos = jsxc.storage.getUserItem('buddy', Strophe.getBareJidFromJid(jid));

            // check friendship
            var chatRoom = infos.type === 'groupchat';

            if (chatRoom !== true) {
                return true;
            }

            var conversName = Strophe.getNodeFromJid(jid);

            // create list element
            var li = $("&lt;li>&lt;/li>")
                .text(conversName)
                .attr({
                    'data-conversjid': jid,
                    'class': 'ui-widget-content'
                });

            list.append(li);

            conversNumber++;

        });

        if (conversNumber &lt; 1) {
            // create list element
            var li = $("&lt;li>&lt;/li>")
                .text("Aucune conversation")
                .attr({
                    'data-conversjid': null,
                    'class': 'ui-widget-content'
                });

            list.append(li);
        }

    };

    // update each time buddy list change
    $(document).on("add.roster.jsxc", updateConversationList);
    $(document).on("cloaded.roster.jsxc", updateConversationList);
    $(document).on("buddyListChanged.jsxc", updateConversationList);

    // first update
    updateConversationList();

    return {
        /**
         * Jquery object on root
         */
        "root": root,

        /**
         * Update list
         */
        "updateConversationList": updateConversationList
    };

};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="jsxc.Message.html">Message</a></li></ul><h3>Namespaces</h3><ul><li><a href="jsxc.html">jsxc</a></li><li><a href="jsxc.gui.html">gui</a></li><li><a href="jsxc.gui.dialog.html">dialog</a></li><li><a href="jsxc.gui.queryActions.html">queryActions</a></li><li><a href="jsxc.gui.roster.html">roster</a></li><li><a href="jsxc.gui.window.html">window</a></li><li><a href="jsxc.muc.html">muc</a></li><li><a href="jsxc.notification.html">notification</a></li><li><a href="jsxc.options.html">options</a></li><li><a href="jsxc.otr.html">otr</a></li><li><a href="jsxc.storage.html">storage</a></li><li><a href="jsxc.webrtc.html">webrtc</a></li><li><a href="jsxc.xmpp.html">xmpp</a></li><li><a href="jsxc.xmpp.bookmarks.html">bookmarks</a></li><li><a href="jsxc.xmpp.carbons.html">carbons</a></li><li><a href="menu.html">menu</a></li></ul><h3>Global</h3><ul><li><a href="global.html#root">root</a></li><li><a href="global.html#updateBuddyList">updateBuddyList</a></li><li><a href="global.html#updateConversationList">updateConversationList</a></li><li><a href="global.html#updateRoomList">updateRoomList</a></li><li><a href="global.html#updateUserList">updateUserList</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Jul 05 2016 00:44:42 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
